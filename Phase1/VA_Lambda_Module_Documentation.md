
| title                             | status | audience                                    | authors                             | version | date       | gpt_model         |
|-----------------------------------|--------|---------------------------------------------|-------------------------------------|---------|------------|-------------------|
| VA-Lambda Module – VirtualAgentics| Draft  | Internal – DevOps/Infra Team, Contributors  | VirtualAgentics Infrastructure Team | 0.1     | 2025-06-14 | Generated by ChatGPT-4.5 |

# VA-Lambda Terraform Module

This document details the VA-Lambda Terraform module, facilitating deployment of AWS Lambda functions for VirtualAgentics Phase 1, ensuring consistency, best practices, and simplified operations.

## Overview

The **VA-Lambda** module automates the deployment of serverless functions (Lambda) for VirtualAgentics Phase 1 agents including Content Generation, Review, and Publishing. It encapsulates common configurations such as runtime setup, IAM roles, and logging, enabling streamlined deployments with minimal duplication and maximum security.

## Scope/Purpose

This module provisions:

- **AWS Lambda Function:** Specified with runtime, handler, memory allocation, timeout, and code artifact location.
- **IAM Role and Policies:** Optionally creates a role with basic execution permissions and additional specified policies. External roles can be used by providing an ARN.
- **CloudWatch Log Group:** Explicitly managed with defined retention settings.
- **Event Triggers:** Optional creation of event triggers like schedules via EventBridge or service events (S3, DynamoDB).

## Assumptions/Constraints

- Lambda artifacts (zip files) must be available beforehand (via CI pipeline or S3).
- Infrastructure prerequisites (IAM roles, VPC, security groups) must exist if using external references.
- Secrets managed via AWS Secrets Manager; module does not handle creation, only references existing ARNs.

## Architecture Details

Each Lambda deployed via this module integrates into the agent-based system of VirtualAgentics. For example, the ContentGen Lambda could trigger from manual invocation, scheduled tasks, or API calls and perform actions such as interacting with DynamoDB, Secrets Manager, or S3.

## Usage Example

```hcl
module "contentgen_lambda" {
  source                 = "./modules/va-lambda"
  function_name          = "va-prod-contentgen-lambda"
  code_s3_bucket         = "va-prod-lambda-artifacts"
  code_s3_key            = "contentgen/v1.0/contentgen.zip"
  runtime                = "python3.9"
  handler                = "contentgen.handler"
  memory_size            = 512
  timeout                = 30
  environment_variables  = {
    "ENV" = "prod",
    "OPENAI_API_KEY_SECRET_ARN" = "arn:aws:secretsmanager:region:account-id:secret:va-prod-openai-api"
  }
  create_role            = true
  role_name              = "va-prod-contentgen-lambda-role"
  additional_policies    = ["arn:aws:iam::aws:policy/AWSLambdaBasicExecutionRole"]
  tags                   = {
    Project     = "VirtualAgentics",
    Environment = "prod",
    Owner       = "content-team",
    Purpose     = "content-generation-agent"
  }
}
```

- Artifact bucket/key provided by CI/CD.
- IAM role created unless `create_role` is false, which requires existing role ARN.
- VPC integration optional.

## Inputs
(As detailed previously)

## Outputs
(As detailed previously)

## Example Scenarios
(As detailed previously)

## Dependencies/Prerequisites
(As detailed previously)

## Testing
(As detailed previously)

## Versioning
Semantic versioning in `virtualagentics-iac` repository. Lambda function code versioning handled separately by CI/CD pipelines; module focuses on infrastructure changes and enhancements.
